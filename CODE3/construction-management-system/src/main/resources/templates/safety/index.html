<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/main}">

<head>
    <title>安全记录 - 公路施工人员管理系统</title>
</head>

<body>
    <div layout:fragment="content">
        <!-- 页面标题 -->
        <div class="page-header d-flex justify-content-between align-items-center">
            <div>
                <h1 class="page-title">安全记录</h1>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb breadcrumb-custom">
                        <li class="breadcrumb-item"><a href="/"><i class="bi bi-house-fill me-1"></i>首页</a></li>
                        <li class="breadcrumb-item active" aria-current="page">安全记录</li>
                    </ol>
                </nav>
            </div>
            <div>
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSafetyRecordModal">
                    <i class="bi bi-plus-lg me-1"></i>添加记录
                </button>
            </div>
        </div>

        <!-- 统计卡片 -->
        <div class="row g-4 mb-4">
            <div class="col-xl-3 col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="stat-icon bg-success text-white me-3">
                                <i class="bi bi-shield-check"></i>
                            </div>
                            <div>
                                <h6 class="card-title mb-0 text-muted">安全天数</h6>
                            </div>
                        </div>
                        <h2 class="fs-1 fw-bold mb-0" th:text="${safetyDays ?: 0}">0</h2>
                        <div class="progress mt-3" style="height: 6px;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="stat-icon bg-warning text-white me-3">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <div>
                                <h6 class="card-title mb-0 text-muted">轻微事故</h6>
                            </div>
                        </div>
                        <h2 class="fs-1 fw-bold mb-0" th:text="${minorIncidents ?: 0}">0</h2>
                        <div class="progress mt-3" style="height: 6px;">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="stat-icon bg-danger text-white me-3">
                                <i class="bi bi-exclamation-circle"></i>
                            </div>
                            <div>
                                <h6 class="card-title mb-0 text-muted">一般事故</h6>
                            </div>
                        </div>
                        <h2 class="fs-1 fw-bold mb-0" th:text="${moderateIncidents ?: 0}">0</h2>
                        <div class="progress mt-3" style="height: 6px;">
                            <div class="progress-bar bg-danger" role="progressbar" style="width: 15%;" aria-valuenow="15" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-xl-3 col-md-6">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="stat-icon bg-dark text-white me-3">
                                <i class="bi bi-x-circle"></i>
                            </div>
                            <div>
                                <h6 class="card-title mb-0 text-muted">重大事故</h6>
                            </div>
                        </div>
                        <h2 class="fs-1 fw-bold mb-0" th:text="${majorIncidents ?: 0}">0</h2>
                        <div class="progress mt-3" style="height: 6px;">
                            <div class="progress-bar bg-dark" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 安全记录列表 -->
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-transparent">
                <div class="row align-items-center">
                    <div class="col">
                        <h5 class="card-title mb-0">安全记录列表</h5>
                    </div>
                    <div class="col-auto">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="搜索..." id="searchInput">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">工人</th>
                                <th scope="col">项目</th>
                                <th scope="col">事件类型</th>
                                <th scope="col">严重程度</th>
                                <th scope="col">发生时间</th>
                                <th scope="col">状态</th>
                                <th scope="col">操作</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="record : ${records}">
                                <td th:text="${record.id}">1</td>
                                <td th:text="${record.workerName}">张三</td>
                                <td th:text="${record.projectName}">公路桥梁修缮工程</td>
                                <td th:text="${record.eventType}">设备故障</td>
                                <td>
                                    <span th:class="${'badge ' + 
                                        (record.severityLevel == '轻微' ? 'bg-warning' : 
                                        (record.severityLevel == '一般' ? 'bg-danger' : 
                                        (record.severityLevel == '重大' ? 'bg-dark' : 'bg-success')))}"
                                          th:text="${record.severityLevel}">轻微</span>
                                </td>
                                <td th:text="${#temporals.format(record.occurrenceTime, 'yyyy-MM-dd HH:mm')}">2024-03-15 14:30</td>
                                <td>
                                    <span th:class="${'badge ' + 
                                        (record.status == '已处理' ? 'bg-success' : 
                                        (record.status == '处理中' ? 'bg-warning' : 'bg-danger'))}"
                                          th:text="${record.status}">已处理</span>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <button type="button" class="btn btn-sm btn-outline-primary" 
                                                th:onclick="'viewRecord(' + ${record.id} + ')'">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-warning"
                                                th:onclick="'editRecord(' + ${record.id} + ')'">
                                            <i class="bi bi-pencil"></i>
                                        </button>
                                        <button type="button" class="btn btn-sm btn-outline-danger"
                                                th:onclick="'deleteRecord(' + ${record.id} + ')'">
                                            <i class="bi bi-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card-footer bg-transparent">
                <nav aria-label="Page navigation">
                    <ul class="pagination justify-content-end mb-0">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1" aria-disabled="true">上一页</a>
                        </li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item"><a class="page-link" href="#">2</a></li>
                        <li class="page-item"><a class="page-link" href="#">3</a></li>
                        <li class="page-item">
                            <a class="page-link" href="#">下一页</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>

        <!-- 添加安全记录模态框 -->
        <div class="modal fade" id="addSafetyRecordModal" tabindex="-1" aria-labelledby="addSafetyRecordModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addSafetyRecordModalLabel">添加安全记录</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addSafetyRecordForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="workerId" class="form-label">工人</label>
                                    <select class="form-select" id="workerId" name="workerId" required>
                                        <option value="">请选择工人</option>
                                        <option th:each="worker : ${workers}"
                                                th:value="${worker.id}"
                                                th:text="${worker.name}">张三</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="projectId" class="form-label">项目</label>
                                    <select class="form-select" id="projectId" name="projectId" required>
                                        <option value="">请选择项目</option>
                                        <option th:each="project : ${projects}"
                                                th:value="${project.id}"
                                                th:text="${project.name}">公路桥梁修缮工程</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="eventType" class="form-label">事件类型</label>
                                    <select class="form-select" id="eventType" name="eventType" required>
                                        <option value="">请选择事件类型</option>
                                        <option value="设备故障">设备故障</option>
                                        <option value="人员受伤">人员受伤</option>
                                        <option value="安全隐患">安全隐患</option>
                                        <option value="其他">其他</option>
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="severityLevel" class="form-label">严重程度</label>
                                    <select class="form-select" id="severityLevel" name="severityLevel" required>
                                        <option value="">请选择严重程度</option>
                                        <option value="轻微">轻微</option>
                                        <option value="一般">一般</option>
                                        <option value="重大">重大</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label for="description" class="form-label">事件描述</label>
                                    <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
                                </div>
                                <div class="col-12">
                                    <label for="location" class="form-label">发生地点</label>
                                    <input type="text" class="form-control" id="location" name="location" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="occurrenceTime" class="form-label">发生时间</label>
                                    <input type="datetime-local" class="form-control" id="occurrenceTime" name="occurrenceTime" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="status" class="form-label">处理状态</label>
                                    <select class="form-select" id="status" name="status" required>
                                        <option value="未处理">未处理</option>
                                        <option value="处理中">处理中</option>
                                        <option value="已处理">已处理</option>
                                    </select>
                                </div>
                                <div class="col-12">
                                    <label for="measures" class="form-label">处理措施</label>
                                    <textarea class="form-control" id="measures" name="measures" rows="3"></textarea>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                        <button type="button" class="btn btn-primary" onclick="submitSafetyRecord()">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 页面特定脚本 -->
    <th:block layout:fragment="scripts">
        <script>
            // 查看安全记录详情
            function viewRecord(id) {
                // TODO: 实现查看详情功能
                console.log('查看记录:', id);
            }

            // 编辑安全记录
            function editRecord(id) {
                // TODO: 实现编辑功能
                console.log('编辑记录:', id);
            }

            // 删除安全记录
            function deleteRecord(id) {
                if (confirm('确定要删除这条安全记录吗？')) {
                    // TODO: 实现删除功能
                    console.log('删除记录:', id);
                }
            }

            // 提交安全记录表单
            function submitSafetyRecord() {
                const form = document.getElementById('addSafetyRecordForm');
                if (form.checkValidity()) {
                    // TODO: 实现表单提交功能
                    console.log('提交表单');
                    
                    // 关闭模态框
                    const modal = bootstrap.Modal.getInstance(document.getElementById('addSafetyRecordModal'));
                    modal.hide();
                    
                    // 显示成功消息
                    const alertContainer = document.createElement('div');
                    alertContainer.className = 'alert alert-success alert-dismissible fade show';
                    alertContainer.setAttribute('role', 'alert');
                    alertContainer.innerHTML = `
                        <i class="bi bi-check-circle-fill me-2"></i>
                        <span>安全记录添加成功</span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    `;
                    
                    // 添加到页面顶部
                    const mainContent = document.querySelector('main');
                    mainContent.insertBefore(alertContainer, mainContent.firstChild);
                    
                    // 5秒后自动关闭
                    setTimeout(() => {
                        const bsAlert = new bootstrap.Alert(alertContainer);
                        bsAlert.close();
                    }, 5000);
                } else {
                    form.reportValidity();
                }
            }

            // 搜索功能
            document.getElementById('searchInput').addEventListener('input', function(e) {
                const searchText = e.target.value.toLowerCase();
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchText) ? '' : 'none';
                });
            });
        </script>
    </th:block>
</body>
</html> 